Of course. Here is a comprehensive Product Requirement Document (PRD) draft based on your detailed requirements. This document structures your ideas into a formal format that can be used for planning, development, and stakeholder alignment.

---

## Product Requirement Document (PRD): Kostolany Egg Trading Analyst

**Version:** 0.90.2
**Date:** October 26, 2023
**Author:** Austin Chang
**Status:** Draft

---

### 1. Overview & Vision

This document outlines the requirements for a web-based trading analysis and management application. The core vision is to automate the monitoring of the Taiwanese stock market (TWSE) by combining **Kostolany's Egg Theory** for long-term phase identification with **short-term technical indicators** for precise entry and exit points.

The application will provide traders with a real-time, actionable dashboard to manage a watchlist, identify opportunities, and execute a disciplined trading strategy.

### 2. Problem Statement

Traders lack a unified tool that:
1.  **Automates** the collection and ranking of high-volume value stocks.
2.  **Synthesizes** long-term market phase analysis (Kostolany) with short-term technical signals.
3.  **Presents** complex technical data in an intuitive, Notion-like matrix interface for rapid decision-making.
4.  **Manages** multiple target lists dynamically throughout the trading day.

### 3. Goals & Objectives

| Goal                                 | Objective / Key Result                                                                                                                     |
| :----------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------- |
| **Automate Market Data Flow**        | Automatically fetch, update, and rank the top 100 stocks by Volume Value (VV100) from the TWSE API according to a strict daily schedule.   |
| **Provide Multi-Timeframe Analysis** | Calculate and display key technical indicators (Moving Averages, SAR) on both Weekly and Daily charts for all VV100 stocks.                |
| **Classify Market Phase**            | Automatically judge and display the current Kostolany Egg phase (e.g., A2, B1) for each stock based on weekly chart analysis.              |
| **Streamline Workflow**              | Enable users to intuitively sort, filter, and move stocks between different target lists using a flexible, database-like matrix interface. |
| **Enhance User Engagement**          | Integrate a service chatbot to assist users and facilitate communication within user groups.                                               |

### 4. User Stories & Epics

#### Epic 1: Real-Time Market Data & Scheduler
*   **As a** trader,
*   **I want** the system to automatically update the VV100 list every 30 minutes during market hours,
*   **so that** I always have an accurate view of the most active stocks.

*   **As a** system,
*   **I want** to execute a daily scheduled routine (clear yesterday's data, initialize today's list, start/stop trading updates, finalize data),
*   **so that** data integrity is maintained without manual intervention.

#### Epic 2: Technical Analysis Dashboard (Matrix View)
*   **As a** trader,
*   **I want** to view a main matrix of the VV100 stocks with default TWSE fields (e.g., code, name, price, change, volume),
*   **so that** I can quickly scan the market.

*   **As a** trader,
*   **I want** to right-click a stock name and assign it to one of my 6 target lists via a dropdown menu,
*   **so that** I can organize my watchlist efficiently.

*   **As a** trader,
*   **I want** to insert, delete, and reorder technical analysis objects (like MA crossovers, SAR dots) as columns in the matrix,
*   **so that** I can customize the data I see for my strategy.

#### Epic 3: Technical Indicators & Calculation
*   **As a** trader,
*   **I want** to see for each stock:
    *   Weekly MA(2,10,26) cross-over/under status and the number of bars since the cross.
    *   Daily MA(2,10,50,132) cross-over/under status and the number of bars since the cross.
    *   The slope (positive/negative) for each of these Moving Averages.
    *   The current Weekly and Daily SAR value (high/low dot) and the count of consecutive dots.
*   **so that** I have a consolidated view of key technical signals.

#### Epic 4: Kostolany Egg Phase Judgement
*   **As a** trader,
*   **I want** the system to automatically determine and display the current Kostolany Egg phase (Y, A1, A2, A3, X, B1, B2, B3) for a stock based on its weekly chart,
*   **so that** I can understand the long-term context before making a short-term trade.

#### Epic 5: Chatbot Service
*   **As a** user,
*   **I want** to interact with a service chatbot to get help and communicate with my group,
*   **so that** I can resolve queries and collaborate with others.

---

### 5. Functional Requirements

#### 5.1. Data Management & Scheduler (`scheduler.ts`)
*   **FR-1.1:** A backend scheduler must run daily tasks at precise times as per the schedule below.
*   **FR-1.2:** The VV100 list must be sourced from the official TWSE API.
*   **Daily Schedule:**
    *   **08:40:** Clear the previous day's main VV100 view. Archive yesterday's data.
    *   **09:00:** Begin live trading data updates.
    *   **09:03:** Display the initial VV100 list. Update the list every 5 minutes thereafter.
    *   **13:30:** Stop live updates, marking the end of the trading day.
    *   **14:30:** Run a final data confirmation process to solidify the day's data.

#### 5.2. Matrix Display & User Interface
*   **FR-2.1:** The primary interface must be a matrix (spreadsheet/database-like view).
*   **FR-2.2:** The main view must display the "Main 100" (VV100) list.
*   **FR-2.3:** The system must support 6 additional, user-managed "Target Lists".
*   **FR-2.4:** Users must be able to perform the following actions on matrix columns (fields):
    *   **Insert:** Add a new technical indicator column from a pulldown menu.
    *   **Delete:** Remove a column.
    *   **Reorder:** Move columns forward/backward via drag-and-drop.
*   **FR-2.5:** Right-click context menu on a stock's name must provide a "Copy to Target List" option with a dropdown to select the destination list.
*   **FR-2.6:** Right-click context menu on other fields should allow sorting (Ascend/Descend).

#### 5.3. Technical Objects & Calculations
*   **FR-3.1:** The system must calculate the following **Weekly** indicators:
    *   MAs: 2, 10, 26 periods.
    *   Crossover/Crossunder (XO/XU) between these MAs and the count of periods since the event.
    *   Slope (positive/negative) for each MA.
    *   SAR (Parabolic SAR) and the count of consecutive dots.
*   **FR-3.2:** The system must calculate the following **Daily** indicators:
    *   MAs: 2, 10, 50, 132 periods.
    *   Crossover/Crossunder (XO/XU) between these MAs and the count of periods since the event.
    *   Slope (positive/negative) for each MA.
    *   SAR (Parabolic SAR) and the count of consecutive dots.

#### 5.4. Kostolany Egg Phase Engine
*   **FR-4.1:** A dedicated engine must analyze the weekly chart data to assign a Kostolany phase.
*   **FR-4.2:** The possible phases are:
    *   **Bullish:** Y (Lowest), A1, A2, A3.
    *   **Bearish:** X (Highest), B1, B2, B3.
*   **FR-4.3:** The judged phase must be displayable as a column in the main matrix.

#### 5.5. Chatbot Module
*   **FR-5.1:** Users must be able to create and manage chat groups.
*   **FR-5.2:** A service chatbot must be available to answer user queries within the application.

---

### 6. Non-Functional Requirements (NFRs)

*   **NFR-1 (Performance):** The UI matrix and technical calculations must update efficiently. The 5-minute data refresh should feel seamless to the user.
*   **NFR-2 (Reliability):** The backend scheduler and data pipeline must be highly reliable. Failed API calls to TWSE must have retry logic and graceful error handling.
*   **NFR-3 (Usability):** The UI must be intuitive and responsive, taking direct inspiration from Notion's flexible database interface. Learning curve for basic operations should be minimal.
*   **NFR-4 (Data Accuracy):** All technical calculations (MA, SAR, slopes) must be mathematically precise and match industry-standard definitions.

---

### 7. Out of Scope (For V1)

*   Automated trade execution via broker APIs.
*   Backtesting simulation environment.
*   Mobile-native application.
*   Advanced charting with drawing tools within the app.
*   User-defined custom indicators.

---

### 8. Future Considerations

*   Integration with additional data sources (e.g., Futures, OTC markets).
*   Alert system based on technical conditions (e.g., "Alert me when MA50 slope turns positive").
*   Portfolio tracking and performance analytics.
*   Expansion to other stock markets (e.g., US markets).

---

### 9. Open Questions / Clarifications Needed

1.  **Kostolany Logic:** What are the specific, rule-based criteria for determining each phase (Y, A1, A2, etc.)? This requires a precise, algorithmic definition.
2.  **TWSE API Limitations:** Are there specific rate limits or data structures for the TWSE Volume Value API that need to be accounted for?
3.  **User Authentication:** Is this a single-user tool, or will it support multiple users with separate accounts and target lists?
4.  **Data Persistence:** How much historical data needs to be stored to calculate the indicators (e.g., MA132 requires 132 days of daily data)?

---